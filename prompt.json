{
  "task": "generate_full_fastapi_postgres_project",
  "output_root": ".",
  "requirements": {
    "title": "정부지원사업 알림 웹사이트 (PostgreSQL 버전)",
    "description": "정부지원사업을 정리하고 알림 기능을 제공하는 FastAPI 기반 웹사이트. PostgreSQL을 사용하며, 로그인/회원가입, 관리자 페이지, 정부지원사업 CRUD가 모두 동작하는 완성형 프로젝트를 생성한다. Python 3.12.12 환경에서 VS Code + launch.json의 'Python: FastAPI' 설정으로 바로 실행 가능해야 한다.",
    "python_version": "3.12.12",
    "tech_stack": {
      "backend": "FastAPI",
      "database": "PostgreSQL",
      "db_driver": "psycopg2-binary",
      "templates": "Jinja2",
      "frontend": "HTML + Bootstrap5",
      "auth": "Session-based authentication (쿠키 세션)"
    },
    "constraints": {
      "main_py_current_state": "파일만 존재하고 내용은 비어있음. 이 파일에 FastAPI 앱 초기화 코드를 완전히 작성해야 한다.",
      "launch_json": "사용자가 이미 .vscode/launch.json 을 만들어 두었으므로 이 파일은 생성하거나 수정하지 않는다. main.py 에 app 객체만 올바르게 정의하면 'Python: FastAPI' 설정으로 uvicorn이 정상적으로 서버를 실행해야 한다."
    },
    "project_structure": {
      "folders": [
        "routes",
        "services",
        "templates",
        "templates/auth",
        "templates/programs",
        "templates/admin",
        "static",
        "static/css",
        "db"
      ],
      "files": [
        "main.py",
        "routes/auth.py",
        "routes/programs.py",
        "routes/admin.py",
        "routes/notify.py",
        "services/db.py",
        "services/auth_service.py",
        "services/program_service.py",
        "services/notify_service.py",
        "templates/base.html",
        "templates/auth/login.html",
        "templates/auth/register.html",
        "templates/programs/list.html",
        "templates/programs/detail.html",
        "templates/programs/create.html",
        "templates/admin/dashboard.html",
        "static/css/style.css",
        "db/schema.sql",
        "requirements.txt",
        ".env.example"
      ]
    },
    "database": {
      "engine": "postgresql",
      "connection": {
        "use_env": true,
        "env_keys": {
          "host": "POSTGRES_HOST",
          "port": "POSTGRES_PORT",
          "database": "POSTGRES_DB",
          "user": "POSTGRES_USER",
          "password": "POSTGRES_PASSWORD"
        },
        "default_values": {
          "POSTGRES_HOST": "localhost",
          "POSTGRES_PORT": "5432",
          "POSTGRES_DB": "main_db",
          "POSTGRES_USER": "admin",
          "POSTGRES_PASSWORD": "admin123"
        }
      },
      "schema_sql": [
        "CREATE TABLE IF NOT EXISTS users (id SERIAL PRIMARY KEY, email VARCHAR(255) UNIQUE NOT NULL, password_hash TEXT NOT NULL, is_admin BOOLEAN DEFAULT FALSE, created_at TIMESTAMP DEFAULT NOW());",
        "CREATE TABLE IF NOT EXISTS programs (id SERIAL PRIMARY KEY, title VARCHAR(255) NOT NULL, description TEXT, support_amount VARCHAR(255), qualification TEXT, deadline DATE, apply_link TEXT, created_at TIMESTAMP DEFAULT NOW());",
        "CREATE TABLE IF NOT EXISTS notifications (id SERIAL PRIMARY KEY, user_id INTEGER REFERENCES users(id) ON DELETE CASCADE, program_id INTEGER REFERENCES programs(id) ON DELETE CASCADE, notify_at TIMESTAMP, created_at TIMESTAMP DEFAULT NOW());"
      ],
      "init_behavior": "services/db.py 에 init_db() 함수를 작성하고, main.py 의 startup 이벤트에서 init_db() 를 호출해서 서버 시작 시 위 스키마를 자동으로 생성하도록 구현한다. DB 접속 오류가 발생할 경우, 명확한 에러 메시지를 출력하고 애플리케이션이 어디에서 실패했는지 알 수 있도록 한다."
    },
    "authentication": {
      "type": "session",
      "description": "사용자가 로그인하면 세션에 user_id, email, is_admin 정보를 저장한다. 비밀번호는 bcrypt로 해시/검증한다.",
      "login_route": "/auth/login",
      "register_route": "/auth/register",
      "logout_route": "/auth/logout",
      "admin_email": "admin@example.com",
      "admin_logic": "회원가입 시 email이 admin@example.com 이면 users.is_admin = TRUE 로 저장한다.",
      "protected_routes": [
        "/programs/create",
        "/programs/{id}/edit",
        "/programs/{id}/delete",
        "/admin"
      ]
    },
    "routes_behavior": {
      "root": {
        "path": "/",
        "behavior": "루트 URL에 접근하면 /programs 로 RedirectResponse를 사용해 302 또는 307 리다이렉트 한다."
      },
      "routers": [
        {
          "file": "routes/auth.py",
          "prefix": "/auth",
          "include_in_main": true,
          "features": [
            "GET /auth/login -> 로그인 폼 렌더링",
            "POST /auth/login -> 인증 후 세션 저장, 실패 시 에러 메시지",
            "GET /auth/register -> 회원가입 폼 렌더링",
            "POST /auth/register -> 입력 검증, 비밀번호 해시 후 DB 저장",
            "GET /auth/logout -> 세션 삭제 후 /auth/login 으로 리다이렉트"
          ]
        },
        {
          "file": "routes/programs.py",
          "prefix": "/programs",
          "include_in_main": true,
          "features": [
            "GET /programs -> 정부지원사업 리스트 페이지 렌더링",
            "GET /programs/{id} -> 상세 페이지",
            "GET /programs/create -> (로그인 + 관리자 권한 필요) 생성 폼",
            "POST /programs/create -> DB에 새 프로그램 저장",
            "GET /programs/{id}/edit -> 수정 폼 (관리자 전용)",
            "POST /programs/{id}/edit -> 수정 반영",
            "POST /programs/{id}/delete -> 삭제 (관리자 전용)"
          ]
        },
        {
          "file": "routes/admin.py",
          "prefix": "/admin",
          "include_in_main": true,
          "features": [
            "GET /admin -> 관리자만 접근 가능. 전체 사용자 수, 프로그램 수, 알림 수 등을 보여주는 간단한 대시보드 페이지."
          ]
        },
        {
          "file": "routes/notify.py",
          "prefix": "/notify",
          "include_in_main": true,
          "features": [
            "POST /notify/{program_id} -> 현재 로그인한 사용자가 특정 프로그램에 대해 알림을 등록하는 엔드포인트. 단순히 notifications 테이블에 레코드만 추가한다.",
            "GET /notify/my -> 사용자가 등록한 알림 리스트를 보여주는 페이지 (선택적으로 구현해도 되지만 최소한 notifications에서 현재 user_id에 해당하는 데이터를 조회하는 예제를 하나 포함한다)."
          ]
        }
      ]
    },
    "main_py_requirements": {
      "description": "main.py 는 FastAPI 앱 전체의 진입점이다. 현재 비어있으므로, 이 파일에 아래 내용을 모두 포함한 완성 코드를 작성해야 한다.",
      "must_include": [
        "from fastapi import FastAPI, Request",
        "from fastapi.staticfiles import StaticFiles",
        "from fastapi.templating import Jinja2Templates",
        "from starlette.middleware.sessions import SessionMiddleware",
        "from fastapi.responses import RedirectResponse",
        "routes.auth.auth_router 또는 router import",
        "routes.programs.programs_router 또는 router import",
        "routes.admin.admin_router 또는 router import",
        "routes.notify.notify_router 또는 router import",
        "app = FastAPI(...) 정의",
        "app.add_middleware(SessionMiddleware, secret_key=...)",
        "app.mount('/static', StaticFiles(...))",
        "템플릿 객체(Jinja2Templates(directory='templates')) 생성",
        "app.include_router(...) 로 모든 라우터 등록",
        "@app.on_event('startup') 데코레이터로 init_db() 호출",
        "@app.get('/') 로 루트에서 /programs 로 RedirectResponse 반환"
      ]
    },
    "templates": {
      "base_html": {
        "file": "templates/base.html",
        "description": "Bootstrap5를 포함한 기본 레이아웃. 상단 네비게이션 바에 '프로그램 목록', '로그인/로그아웃', '관리자' 메뉴를 배치하고, {% block content %}{% endblock %} 영역을 둔다."
      },
      "auth_pages": [
        {
          "file": "templates/auth/login.html",
          "description": "email, password 입력 폼. base.html 을 extends 하며, 로그인 실패 시 에러 메시지를 표시할 수 있도록 한다."
        },
        {
          "file": "templates/auth/register.html",
          "description": "email, password, password 확인 입력 폼. 유효성 에러 메시지를 표시할 수 있도록 한다."
        }
      ],
      "program_pages": [
        {
          "file": "templates/programs/list.html",
          "description": "프로그램 리스트를 테이블 또는 카드 형태로 렌더링. 제목, 마감일, 지원금, 상세 보기 링크, 알림 등록 버튼을 포함한다."
        },
        {
          "file": "templates/programs/detail.html",
          "description": "단일 프로그램의 상세 정보(title, description, support_amount, qualification, deadline, apply_link 등)를 표시한다."
        },
        {
          "file": "templates/programs/create.html",
          "description": "관리자 전용 생성/수정 폼. title, description, support_amount, qualification, deadline, apply_link 입력 필드를 포함한다."
        }
      ],
      "admin_page": {
        "file": "templates/admin/dashboard.html",
        "description": "관리자 전용 대시보드. 전체 사용자 수, 프로그램 수, 알림 수 등을 간단히 보여주는 페이지."
      }
    },
    "static_files": {
      "css": {
        "file": "static/css/style.css",
        "description": "간단한 레이아웃, 마진, 폰트 크기 조정 등 최소한의 커스텀 스타일만 정의한다."
      }
    },
    "requirements": [
      "fastapi",
      "uvicorn",
      "jinja2",
      "python-multipart",
      "psycopg2-binary",
      "bcrypt",
      "itsdangerous",
      "python-dotenv"
    ],
    "notes": [
      "이 프로젝트는 사용자가 이미 가지고 있는 .vscode/launch.json 을 사용한다. main.py 에 app 객체만 올바르게 정의하면 'Python: FastAPI' 구성으로 uvicorn main:app --reload 가 정상 실행되어야 한다.",
      "코드는 최대한 단순하고 읽기 쉽게 작성하며, 불필요한 추상화는 피한다.",
      "에러 발생 시 FastAPI가 반환하는 에러 페이지 외에도, 터미널 로그에 데이터베이스 연결 오류, 테이블 생성 실패 등의 원인을 명확하게 출력하도록 한다."
    ]
  }
}
